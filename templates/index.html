<!-- <form method="POST">
    <input type="text" name="user_text" placeholder="Curhat di sini...">
    <button type="submit">Deteksi Mood</button>
</form>

<form method="POST">
    <input type="hidden" name="use_webcam" value="1">
    <button type="submit">Gunakan Webcam</button>
</form>

{% if mood %}
    <p>Deteksi mood: {{ mood }}</p>
{% endif %}

{% if playlist_url %}
    <p><a href="{{ playlist_url }}" target="_blank">Lihat playlist Spotify ðŸŽµ</a></p>
{% endif %} -->

<!-- debug 2 -->
<!-- <form method="POST">
    <textarea name="user_text" placeholder="Curhat di sini bro..." rows="4" cols="50"></textarea><br><br>

    <button type="submit" name="use_text">Gunakan Teks</button>
    <button type="button" onclick="startWebcam()">Gunakan Webcam</button>
    <button type="submit" name="capture_webcam" style="display:none;" id="captureBtn">Kirim dari Webcam</button>

    <br><br>
    <video id="webcam" autoplay playsinline width="300" height="225" style="display:none;"></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <input type="hidden" name="webcam_image" id="webcam_image">
</form>

{% if mood %}
    <h3>Emosi: {{ mood }}</h3>
    <p><a href="{{ playlist_url }}" target="_blank">Lihat Playlist Spotify ðŸŽµ</a></p>
{% endif %}

<script>
function startWebcam() {
    const video = document.getElementById('webcam');
    const captureBtn = document.getElementById('captureBtn');
    video.style.display = 'block';
    captureBtn.style.display = 'inline-block';

    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
            video.srcObject = stream;
        })
        .catch(err => {
            alert("Webcam gagal dinyalakan: " + err);
        });

    captureBtn.onclick = function() {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);
        const dataUrl = canvas.toDataURL('image/jpeg');
        document.getElementById('webcam_image').value = dataUrl;
        document.forms[0].submit();
    };
}
</script> -->

<!DOCTYPE html>
<html>
<head>
    <title>AI Mood Playlist Generator</title>
    <script>
        async function startWebcam() {
            const video = document.getElementById('webcam');
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
        }

        async function captureAndSend() {
            const canvas = document.getElementById('canvas');
            const video = document.getElementById('webcam');
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

            const imageData = canvas.toDataURL('image/jpeg');

            const response = await fetch('/detect_webcam_emotion', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ image: imageData })
            });

            const data = await response.json();
            if (data.emotion) {
                window.location.href = `/?mood=${data.emotion}`;
            }
        }

        window.onload = startWebcam;
    </script>
</head>
<body>
    <h1>AI Mood-Based Playlist Generator</h1>

    <form method="post">
        <label>Masukkan teks curhat:</label><br>
        <textarea name="text_input" rows="4" cols="50"></textarea><br>
        <button type="submit">Kirim Teks</button>
    </form>

    <h3>Atau gunakan Webcam:</h3>
    <video id="webcam" width="320" height="240" autoplay></video><br>
    <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
    <button onclick="captureAndSend()">Kirim dari Webcam</button>

    {% if mood %}
        <h2>Mood terdeteksi: {{ mood }}</h2>
    {% endif %}

    {% if playlist_url %}
        <p><a href="{{ playlist_url }}" target="_blank">Buka Playlist Spotify</a></p>
    {% endif %}
</body>
</html>
